<nav class="navbar navbar-default header-bar">
  <div class="container-fluid">
    <ul class="nav navbar-nav navbar-left">
      <li>
        <%= link_to image_tag("fb-logo.png"), root_path, class: "logo-img" %>
      </li>
      <li>
        <%= form_tag users_path, method: :get, id: "form-search" do %>
          <%= search_field_tag :search, nil, class: "form-control",
            placeholder: t("layouts.holder") %>
          <%= button_tag "", type: "submit",
            class: "glyphicon glyphicon-search search-button" %>
        <% end %>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right info-bar">
      <li class="user-profile" title="<%= t "layouts.profile" %>">
        <%= image_tag current_user.avatar %>
        <span><%= current_user.last_name %></span>
      </li>
      <li><%= link_to t("layouts.home"), current_user %></li>
      <li class="dropdown">
          <span class="glyphicon glyphicon-user dropdown-toggle" data-toggle="dropdown"></span>
          <span class="badge">
            <%= pluralize(current_user.pending_friend_requests.count, "") %>
          </span>
        <ul class="dropdown-menu friend">
          <% current_user.pending_friend_requests.each do |request| %>
            <li>
              <div class="request">
                <div class="request-image">
                  <%= link_to request.follower do %>
                    <%= image_tag request.follower.avatar %>
                  <% end %>
                </div>
                <div class="request-name">
                  <%= link_to request.follower do %>
                    <%= request.follower.username %>
                  <% end %>
                </div>
                <div class="request-buttons">
                  <%= link_to t("layouts.accept_yes"),
                    relationship_path(request.id), method: :put,
                    class: "btn btn-success" %>
                  <%= link_to t("layouts.accept_no"),
                    relationship_path(request.follower.id),
                    method: :delete, class: "btn btn-danger" %>
                </div>
              </div>
            </li>
          <% end %>
        </ul>
      </li>
      <li class="dropdown">
        <span class="dropdown-toggle glyphicon glyphicon-envelope" aria-hidden="true" data-toggle="dropdown">
        </span>
        <div class="dropdown-menu">
          <ul class="media-list">
          <% if @conversations.present? %>
          <% @conversations.each do |conversation| %>
            <li class="media">
              <%= link_to "javascript:", class: "conversation start-conversation",
                  data: {"cid": conversation.id, sid: conversation.sender_id, rip: conversation.recipient_id} do %>
                <table class="table table-hover">
                  <tr>
                    <td class="media-left">
                      <%= image_tag conversation_interlocutor(conversation).avatar, class: "conversation-image img-circle" %>
                    </td>
                    <% if conversation.messages.any? %>
                    <td class="media-body">
                      <h5 class="media-heading rep-name">
                        <%= conversation_interlocutor(conversation).name %>
                        <time datetime="<%= conversation.messages.last %>">
                          <i style="float: right" id="time"><%= time_ago_in_words(conversation.messages.last.created_at) %> ago</i>
                        </time>
                      </h5>
                        <p><%= conversation.messages.last.body %></p>
                      <% else %>
                        <p> No messages </p>
                      <% end %>
                    </td>
                  </tr>
                </table>
              <% end %>
            </li>
            <% end %>
          <% end %>
          </ul>
        </div>
      </li>
      <li>
        <button class="btn btn-default dropdown-toggle notification-btn"
          id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
          <span class="glyphicon glyphicon-globe" aria-hidden="true"></span>
          <span class="badge">
            0
          </span>
        </button>
      </li>
      <li>
        <button class="btn btn-default dropdown-toggle help-btn"
          id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
          <span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span>
        </button>
      </li>
      <li class="dropdown">
          <span class="glyphicon glyphicon-triangle-bottom dropdown-toggle" data-toggle="dropdown"></span>
        <ul class="dropdown-menu">
          <li><%= link_to t("layouts.profile"), current_user %></li>
          <li>
            <%= link_to t("layouts.setting"), profile_path(current_user) %>
          </li>
          <li class="divider"></li>
          <li>
            <%= link_to t("layouts.logout"), logout_path, method: :delete %>
          </li>
        </ul>
      </li>
    </ul>
  </div>
</nav>
